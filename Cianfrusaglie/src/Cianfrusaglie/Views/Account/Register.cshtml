@using System.Threading.Tasks
@using Cianfrusaglie.Constants
@model Cianfrusaglie.ViewModels.Account.RegisterViewModel
@{
    ViewData[ "Title" ] = "Register";
    Layout = "";
}

@functions
{

    private IEnumerable<Category> GetMacroCategories()
    {
        for (int i = 0; i < (ViewData["numberOfMacroCategories"] as int? ?? 0); i++)
        {
            var categories = ViewData["formMacroCategories"] as List<Category>;
            if (categories != null && categories[i].OverCategory == null)
                yield return categories[i];
        }
    }

    private IEnumerable<Category> GetCategories(Category macro)
    {
        for (int j = 0; j < (ViewData["numberOfMacroCategories"] as int? ?? 0); j++)
        {
            var subCat = ViewData["formMacroCategories"] as List<Category>;
            if (subCat != null && subCat[j].OverCategory != null && subCat[j].OverCategory.Id == macro.Id)
                yield return subCat[j];
        }
    }

}
<html>
<head>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js" ></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" ></script>
    <link href= "https://fonts.googleapis.com/css?family=Source+Sans+Pro"  rel="stylesheet" type="text/css" >
    <link href= "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"  rel="stylesheet" type="text/css" />
    <link href= "~/Content/Register.css"  rel="stylesheet" type="text/css" />
    <link href= "~/Content/Style.css"  rel="stylesheet" type="text/css" />
    <link href= "~/Content/Search.css"  rel="stylesheet" type="text/css" />
    <link href= "https://fonts.googleapis.com/css?family=Lato"  rel="stylesheet" type="text/css" >
    <link href="~/css/maps.css" rel="stylesheet" type="text/css" />

    <script src="http://maps.googleapis.com/maps/api/js?libraries=places"></script>
    <script src="/js/googleMaps.js" ></script>
    <script>
        google.maps.event.addDomListener(window, 'load', initialize);

        function onRegisterSubmit() {
            $("#latitudeInput").attr("value", marker.position.lat());
            $("#longitudeInput").attr("value", marker.position.lng());

            return true;
        }
    </script>

</head>
<body>
    <div id="wrapper-register">
        <form asp-action="Register" asp-controller="Account" id="formRegister" enctype="multipart/form-data" method="post" role="form" onsubmit="return onRegisterSubmit()">
            
            <div id="register" class="form-horizontal form-register form-register1" id="tabellaForm">
                <h1>
                    <a href="~/">@CommonStrings.SiteName</a>
                </h1>
                <h5>Il posto giusto per le tue cianfrusaglie</h5>

                <h2>
                    <!--<i class="glyphicon glyphicon-user"></i>-->
                </h2>
                <hr/>
                <div class="row top-reg">
                    <span class="btn-warning btn" onclick="clickBackButton(2)"><span>1</span>Su di te</span>
                    <span class="btn-gr btn" onclick="clickBackButton(3)"><span>2</span>I tuoi interessi</span>
                    <span class="btn-gr btn" onclick="clickNextButton(2)"><span>3</span>Dati di accesso</span>

                </div>
                <hr/>
                <div asp-validation-summary="ValidationSummary.All" class="text-danger"></div>
                <!-------------------PRIMA PAGINA DELLA REGISTRAZIONE-->
                <!--NOME-->
                <div >
                    <div class="form-group">
                        <label asp-for="Name" class="control-label">Nome</label><label> *</label><br/>
                        <input asp-for="Name" class="form-control"/>
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                    <!--COGNOME-->
                    <div class="form-group">
                        <label asp-for="Surname" class="control-label">Cognome</label><label> *</label><br/>
                        <input asp-for="Surname" class="form-control"/>
                        <span asp-validation-for="Surname" class="text-danger"></span>
                    </div>
                    <!--SESSO-->
                    <div class="form-group row">
                        <label asp-for="Genre" class="control-label">Sesso</label><label> *</label><br/>

                        <label class="radio-inline"><input asp-for="Genre" type="radio" name="Genre" value="@((int)Genre.Male)" class="form-control"/>Uomo</label><br/>
                        <label class="radio-inline"><input asp-for="Genre" type="radio" name="Genre" value="@((int)Genre.Female)" class="form-control"/>Donna</label><br/>
                        <label class="radio-inline"><input asp-for="Genre" type="radio" name="Genre" value="@((int)Genre.Unspecified)" class="form-control"/>Non specificato</label>
                        <span asp-validation-for="Genre" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Photo" class="control-label">Inserisci il tuo indirizzo ( Citt&agrave;, indirizzo)</label><label> *</label>
                        <input id="pac-input" class="form-control" type="text" placeholder="">
                        <div id="googleMap" style="display: none;"></div>
                        <input asp-for="Latitude" id="latitudeInput" class="form-control" type="text" style="display: none;"/>
                        <input asp-for="Longitude" id="longitudeInput" class="form-control" type="text" style="display: none;"/>
                    </div>
                    <div class="form-group">
                        <label asp-for="Photo" class="control-label">Immagine profilo</label><label> *</label>
                        <input asp-for="Photo" class="input-file" id="photo" name="photo" type="file" accept="image/*">
                        <span asp-validation-for="Photo" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        I dati contrassegnati con * sono facoltativi
                    </div>
                </div>
                <div class="form-group">
                    <br/>
                    <span class="btn btn-default col-md-8 btn-next" onclick="clickNextButton(1)">Avanti</span>
                </div>
                <span id="sottoForm"><h5> <a href="~/Account/Login">Effettua l'accesso</a></h5></span>
            </div>
            <!------------------SECONDA PAGINA DELLA REGISTRAZIONE-->
            <div id="register" class="form-horizontal form-register form-register2" id="tabellaForm">
                <h1>
                    <a href="~/">@CommonStrings.SiteName</a>
                </h1>
                <h5>Il posto giusto per le tue cianfrusaglie</h5>

                <hr />
                <div class="row top-reg">
                    <span class="btn-gr btn" onclick="
clickBackButton(2)"><span>1</span>Su di te</span>
                    <span class="btn-warning btn" onclick="clickBackButton(3)"><span>2</span>I tuoi interessi</span>
                    <span class="btn-gr btn" onclick="clickNextButton(2)"><span>3</span>Dati di accesso</span>

                </div>
                <hr/>
                <!---------------------------LE PREFERENZE DELL'UTENTE------------------->
                <div class="panel">
                    <div class="panel-body">
                        <h5>Scegli le tue categorie preferite per avere suggerimenti personalizzati</h5>
                        <br />
                        <div class="panel-group" id="panel-423221" role="tablist" aria-multiselectable="true">
                
                            @foreach (var macroCategory in GetMacroCategories()) {
                                <div class="panel panel-default">
                                    <div class="panel-heading collapsed" role="tab" data-toggle="collapse" data-parent="#panel-423221" style="cursor: pointer" onclick='$("#category-@macroCategory.Id").toggle()' >
                                        @macroCategory.Name
                                    </div>
                                        <div id="category-@macroCategory.Id" class="panel-collapse collapse">
                                            <div class="panel-body">
                                                <div class="form-group">

                                                    <div class="col-md-12">
                                                        @foreach (var category in GetCategories(macroCategory)) {
                                                            <div class="checkbox">
                                                                <label asp-for="CategoryDictionary[category.Id]" for="@category.Id">
                                                                    <input asp-for="CategoryDictionary[category.Id]" class="category-checkboxes" type="checkbox" name="category" id="@category.Id" onchange="setFieldsVisibility();" />
                                                                    @category.Name
                                                                </label>
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                
                            }


                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <br />
                    <span class="btn btn-default col-md-5 btn-back" onclick="clickBackButton(2)">Indietro</span>
                    <span class="btn btn-default col-md-5 btn-next" onclick="clickNextButton(2)">Avanti</span>
                </div>
                <span id="sottoForm"><h5> <a href="~/Account/Login">Effettua l'accesso</a></h5></span>

            </div>
            <!-------------------TERZA PAGINA DELLA REGISTRAZIONE-->
    <div id="register" class="form-horizontal form-register form-register3" id="tabellaForm">
      
        <h1>
            <a href="~/">@CommonStrings.SiteName</a>
        </h1>
        <h5>Il posto giusto per le tue cianfrusaglie</h5>

        <hr />
        <div class="row top-reg">
            <span class="btn-gr btn" onclick="clickBackButton(2)"><span>1</span>Su di te</span>
            <span class="btn-gr btn" onclick="clickBackButton(3)"><span>2</span>I tuoi interessi</span>
            <span class="btn-warning btn" onclick="clickNextButton(2)"><span>3</span>Dati di accesso</span>
        </div>
           
                    <hr />

                    <div class="form-group">
                        <label asp-for="UserName" class="control-label">Username</label><br />
                        <input asp-for="UserName" required="" minlength="3" class="form-control" />
                        <span asp-validation-for="UserName" class="text-danger"></span>

                    </div>

                    <div class="form-group">
                        <label asp-for="Email" class="control-label">Indirizzo email</label><br />
                        <input asp-for="Email" type="email" required="" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Password" class="control-label">Password</label><br />
                        <input asp-for="Password" type="password" required="" minlength="8" class="form-control" id="popoverData"/>
                        <span asp-validation-for="Password" class="text-danger" data-trigger="hover" rel="popover"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="ConfirmPassword" class="control-label">Ripeti password</label><br />
                        <input asp-for="ConfirmPassword" type="password" required="" id="confirmPassword" class="form-control" />
                        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>

                    </div>


                    <!-- questo searchbox serve per cercare l'indirizzo su googleMap -->

                    <div class="form-group">
                        <br />
                        <span class="btn btn-default col-md-5 btn-back" onclick="clickBackButton(3)">Indietro</span>
                        <button class="btn btn-default col-md-5 btn-next" type="submit">Crea il tuo account</button>
                    </div>
                    <span id="sottoForm"><h5> <a href="~/Account/Login">Effettua l'accesso</a></h5></span>
                </div>

</form>
    </div>

<script type="text/javascript" >
    $('#popoverData').change( passwordCheck );
    $("#confirmPassword").change( passwordCheck );

    function passwordCheck() {
        //if( $('#popoverData').val().length < 8 ) 
        //    $('#popoverData').get(0).setCustomValidity('La password deve contenere almeno 8 caratteri!');
        //else
        //    $('#popoverData').get(0).setCustomValidity('');

        if( $("#popoverData").val() != $("#confirmPassword").val() )
            $("#confirmPassword").get(0).setCustomValidity('La password di conferma è diversa dalla password!');
        else
            $("#confirmPassword").get(0).setCustomValidity('');
    }

    function clickNextButton(tmp) {
        if (tmp === 1) {
            $('.form-register1').hide();
            $('.form-register3').hide();
            $('.form-register2').show();
        }
        else if (tmp === 2) {
            $('.form-register2').hide();
            $('.form-register1').hide();
            $('.form-register3').show();
        }
    }

    function clickBackButton(tmp) {
        if (tmp === 2) {
            $('.form-register1').show();
            $('.form-register2').hide();
            $('.form-register3').hide();
        }
        else if (tmp === 3) {
            $('.form-register2').show();
            $('.form-register1').hide();
            $('.form-register3').hide();
        }
    }
</script>
</body>
</html>